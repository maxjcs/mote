<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper     PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xuexibao.teacher.dao.DynamicUpvoteDao">
	<select id="loadDynamicUpvote" resultType="DynamicUpvote" parameterType="DynamicUpvote">
		<![CDATA[
			select *
			from teacher_dynamic_upvote 
			where dynamic_id=#{dynamicId} and votor_id=#{votorId} 
			limit 1
		 ]]>
	</select>

	<select id="listDynamicUpvote" resultType="DynamicUpvote" parameterType="map">
		<![CDATA[
			select *
			from teacher_dynamic_upvote 
			where id <#{lastId}
			order by id desc 
			limit #{pageSize}
		]]>
	</select>

	<select id="listUpVoteByIds" resultType="DynamicUpvote" parameterType="map">
			select *
			from teacher_dynamic_upvote 
			where votor_id=#{votorId} and dynamic_id in 
			 <foreach item="item" index="index" collection="dynamicIds" open="(" separator="," close=")">  
		 		 #{item}  
		 	 </foreach> 
	</select>

	<insert id="addDynamicUpvote"  useGeneratedKeys="true" keyProperty="id"  parameterType="DynamicUpvote">
		insert into
		teacher_dynamic_upvote(
			dynamic_id,
			create_time,
			votor_id
		)
		values(
					#{dynamicId},
					#{createTime},
					#{votorId}
		)
	</insert>

	<delete id="deleteDynamicUpvote" parameterType="DynamicUpvote">
		<![CDATA[
			delete 
			from teacher_dynamic_upvote 
			where dynamic_id=#{dynamicId} and votor_id=#{votorId} 
		]]>
	</delete>
	
	<select id="groupCountUpvoteByDynamicIds" resultType="Dynamic" >
         select dynamic_id id,count(*) count_upvote
         from teacher_dynamic_upvote 
         where dynamic_id in 
			<foreach item="item" index="index" collection="list" open="(" separator="," close=")">  
			  #{item}  
			</foreach>
		 group by dynamic_id
    </select>
</mapper> 