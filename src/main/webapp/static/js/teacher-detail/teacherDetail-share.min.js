/*! Created by Feil.Wang(wangfeilong@xuexibao.cn) on 2015/6/29. */
!function(e,o,a){"use strict";var s=Util.getUrlParam("teacherId");e.root=o.define({$id:"root",pageTitle:"",defaultAvatarUrl:WEB_SERVER+"/static/images/default-avatar@2x.png",initialized:!1}),e.teacherHome=o.define({$id:"teacherHome",teacherId:s,teacherInfo:{},showMore:function(){var e=a(this);e.hasClass("hasmore")&&e.toggleClass("ellipsis")}}),e.workbook=o.define({$id:"workbook",wbList:[],pageNo:0,moreWorkbook:function(){workbook.pageNo++,t.getWorkBookList(workbook.pageNo,function(e){workbook.wbList=workbook.wbList.concat(e.data),console.log("加载更多习题集：",workbook.wbList)})}}),e.guessbook=o.define({$id:"guessbook",gbCount:"",gbReplyer:"",gbList:[],pageNo:1,isLoading:!1,isLastPage:!1,moreLeaveMsg:function(){guessbook.isLoading||(guessbook.isLoading=!0,guessbook.pageNo++,t.getLeaveMessages(guessbook.pageNo,function(e){var o=Math.ceil(e.data.teacherMessageCount/10);console.log("当前页：",guessbook.pageNo,"总页数：",o),guessbook.pageNo==o&&(guessbook.isLastPage=!0);for(var a=guessbook.gbList,s=e.data.teacherMessage,t=e.data.teacherMessage,i=0;i<s.length;i++)for(var n=0;n<a.length;n++)a[n].id==s[i].id&&t.splice(i,1);guessbook.gbList.pushArray(t),guessbook.isLoading=!1}))}}),o.scan(document.body);var t={getTeacherInfo:function(){a.ajax({method:"post",dataType:"json",data:{teacherId:s},url:API_SERVER+"/api/user/getTeacherById",success:function(e){console.log("基本信息：",e),e.success?(root.initialized=!0,e.data?(root.pageTitle=e.data.isOrg?e.data.nickname:e.data.nickname+"老师",teacherHome.teacherInfo=e.data,Util.ellipsis()):a(document.body).html('<div class="error-layer"><p>该教师不存在！</p></div>')):alert("基本信息加载失败！")}})},getWorkBookList:function(e,o){a.ajax({method:"post",dataType:"json",url:API_SERVER+"/api/audioset/listAudioSetByTeacherId",data:{teacherId:s,pageNo:e},success:function(e){console.log("习题集：",e),e.success?o(e):alert("习题集加载失败！")}})},getLeaveMessages:function(e,o){a.ajax({method:"post",dataType:"json",url:API_SERVER+"/api/teacherMessage/summaryTeacherMessageForH5",data:{teacherId:s,pageNo:e},success:function(e){console.log("留言：",e),e.success?o(e):alert("留言加载失败！")}})}};t.getTeacherInfo(),t.getLeaveMessages(1,function(e){guessbook.gbCount=e.data.countMessage,guessbook.gbReplyer=e.data.countReplyer,guessbook.gbList=e.data.messages,guessbook.gbCount<=10&&(guessbook.isLastPage=!0)}),t.getWorkBookList(0,function(e){workbook.wbList=e.data,Util.clipWbTxt()}),a(function(){a(document.body).on("click",".app-dl-link",function(){e.location.href="http://www.xuexibao.cn/html/download.html"})})}(window,avalon,Zepto);