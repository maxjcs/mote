/*! Created by Feil.Wang(wangfeilong@xuexibao.cn) on 2015/6/29. */
!function(e,o,t){"use strict";function a(){n.getLeaveMessages(function(e){guessbook.gbCount=e.data.countMessage,guessbook.gbReplyer=e.data.countReplyer,guessbook.gbList=e.data.messages})}var s=Util.getUrlParam("teacherId");e.root=o.define({$id:"root",pageTitle:"",defaultAvatarUrl:WEB_SERVER+"/static/images/default-avatar@2x.png",initialized:!1}),e.teacherHome=o.define({$id:"teacherHome",teacherId:s,teacherInfo:{},showMore:function(){var e=t(this);e.hasClass("hasmore")&&e.toggleClass("ellipsis")},goToQRCodeView:function(){console.log("跳转到二维码页"),e.external.goToQRCodeView()},goToFollowed:function(){console.log("跳转到关注我的学生页"),e.external.goToFollowed()}}),e.workbook=o.define({$id:"workbook",wbList:[],wbItemDetail:function(o){console.log("跳转到习题集详情：",o),e.external.workbookDetail(o)},pageNo:0,moreWorkbook:function(){workbook.pageNo++,n.getWorkBookList(workbook.pageNo,function(e){workbook.wbList=workbook.wbList.concat(e.data),console.log("加载更多习题集：",workbook.wbList)})},goWbList:function(){console.log("跳转到习题集列表"),e.external.workbookList()}}),e.guessbook=o.define({$id:"guessbook",gbCount:"",gbReplyer:"",gbList:[],deleteMessage:function(o,t){o.stopPropagation(),console.log("删除留言：id=",t),e.external.deleteMessage(t)},goMessageList:function(){console.log("进入留言列表页"),e.external.goMessageList()},goMessageDetail:function(o){console.log("进入该条留言详情页：id=",o),e.external.goMessageDetail(o)}}),o.scan(document.body);var n={getTeacherInfo:function(){t.ajax({method:"post",dataType:"json",data:{teacherId:s},url:API_SERVER+"/api/user/getTeacherById",success:function(o){console.log("基本信息：",o),o.success?(root.initialized=!0,o.data?(root.pageTitle=o.data.isOrg?o.data.nickname:o.data.nickname+"老师",teacherHome.teacherInfo=o.data,Util.ellipsis()):t(document.body).html('<div class="error-layer"><p>该教师不存在！</p></div>'),e.external.hideLoading()):e.external.errorTips("基本信息加载失败！")}})},getWorkBookList:function(o,a){t.ajax({method:"post",dataType:"json",url:API_SERVER+"/api/audioset/listAudioSetByTeacherId",data:{teacherId:s,pageNo:o},success:function(o){console.log("习题集：",o),o.success?a(o):e.external.errorTips("习题集加载失败！")}})},getLeaveMessages:function(o){t.ajax({method:"post",dataType:"json",url:API_SERVER+"/api/teacherMessage/summaryTeacherMessageForH5",data:{teacherId:s},success:function(t){console.log("留言：",t),t.success?o(t):e.external.errorTips("留言加载失败！")}})}};n.getTeacherInfo(),n.getLeaveMessages(function(e){guessbook.gbCount=e.data.countMessage,guessbook.gbReplyer=e.data.countReplyer,guessbook.gbList=e.data.messages}),n.getWorkBookList(0,function(e){workbook.wbList=e.data,Util.clipWbTxt()}),e.jsInvoke=function(e,o){switch(console.log(e,":",o),e){case"refreshMessage":a(o);break;default:console.warn("externalMessage: type -"+e+" is unknown",o)}},t(function(){e.external.hideLoading()})}(window,avalon,Zepto);